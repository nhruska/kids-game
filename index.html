<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Science Explorer: Planet Rescue</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        #bins {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }

        .bin {
            width: 150px;
            height: 200px;
            border: 2px solid #ff9800;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            border-radius: 15px;
            background: #f0f0f0;
            font-size: 1.1em;
            padding: 10px;
            box-sizing: border-box;
            transition: transform 0.3s;
            overflow: hidden;
        }

        .bin .trash-item {
            margin-top: 5px;
            background-color: #ffffff;
            padding: 5px;
            border-radius: 10px;
        }

        .bin:hover {
            transform: scale(1.1);
            background: #ffe0b2;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="splash-screen">
            <h1>Science Explorer: Planet Rescue</h1>
            <button id="start-game-button">Start Game</button>
        </div>
        <div id="mini-game-1" class="mini-game" style="display: none;">
            <h2>Swipe Away Pollution</h2>
            <p>Pollution Level: <span id="pollution-level">100%</span></p>
            <div id="swipe-area" ontouchstart="handleSwipe(event)" ontouchend="handleSwipeEnd(event)">Swipe left or right to clean up!</div>
        </div>
        <div id="mini-game-2" class="mini-game" style="display: none;">
            <h2>Forest Restoration</h2>
            <p>Forest Health: <span id="forest-health">80%</span></p>
            <button id="plant-tree-button">Plant Tree</button>
            <button id="place-shelter-button">Place Shelter</button>
        </div>
        <div id="mini-game-3" class="mini-game" style="display: none;">
            <h2>Trash Sorting</h2>
            <div id="trash-items">
                <div class="trash-item" draggable="true" data-type="recycling" id="plastic-bottle">Plastic Bottle</div>
                <div class="trash-item" draggable="true" data-type="trash" id="banana-peel">Banana Peel</div>
                <div class="trash-item" draggable="true" data-type="recycling" id="paper">Paper</div>
            </div>
            <div id="bins">
                <div id="recycling-bin" class="bin" data-type="recycling">Recycling Bin</div>
                <div id="trash-bin" class="bin" data-type="trash">Trash Bin</div>
            </div>
        </div>
        <div id="success-screen" style="display: none;">
            <h2>Success!</h2>
            <p>Congratulations! You completed this mini-game.</p>
            <button id="next-game-button">Next Challenge</button>
        </div>
    </div>
    <script src="game.js"></script>
    <script>
        let startX;

        function handleSwipe(event) {
            startX = event.touches[0].clientX;
        }

        function handleSwipeEnd(event) {
            let endX = event.changedTouches[0].clientX;
            let difference = endX - startX;
            if (Math.abs(difference) > 50) { // Swipe detected
                let swipeEvent = new Event('swipe');
                document.getElementById('swipe-area').dispatchEvent(swipeEvent);
            }
        }

        document.querySelectorAll('.trash-item').forEach(item => {
            item.addEventListener('touchstart', dragStartTouch);
        });

        document.querySelectorAll('.bin').forEach(bin => {
            bin.addEventListener('dragover', dragOver);
            bin.addEventListener('drop', drop);
            bin.addEventListener('touchmove', dragOverTouch);
            bin.addEventListener('touchend', dropTouch);
        });

        function dragStart(event) {
            event.dataTransfer.setData('text', event.target.id);
        }

        function dragStartTouch(event) {
            event.dataTransfer = {
                setData: function(key, value) {
                    this[key] = value;
                },
                getData: function(key) {
                    return this[key];
                }
            };
            event.dataTransfer.setData('text', event.target.id);
        }

        function dragOver(event) {
            event.preventDefault();
        }

        function dragOverTouch(event) {
            event.preventDefault();
        }

        function drop(event) {
            event.preventDefault();
            const itemId = event.dataTransfer.getData('text');
            const itemType = document.getElementById(itemId).dataset.type;
            const binType = event.target.dataset.type;

            if (itemType === binType) {
                const item = document.getElementById(itemId);
                event.target.appendChild(item);
                item.setAttribute('draggable', 'false');
                item.classList.add('sorted-item');
                checkAllSorted();
            } else {
                alert('Incorrect bin! Try again.');
            }
        }

        function dropTouch(event) {
            event.preventDefault();
            const touch = event.changedTouches[0];
            const targetElement = document.elementFromPoint(touch.clientX, touch.clientY);
            const itemId = event.target.id;
            const itemType = document.getElementById(itemId).dataset.type;
            const binType = targetElement.dataset.type;

            if (itemType === binType) {
                const item = document.getElementById(itemId);
                targetElement.appendChild(item);
                item.setAttribute('draggable', 'false');
                item.classList.add('sorted-item');
                checkAllSorted();
            } else {
                alert('Incorrect bin! Try again.');
            }
        }

        function checkAllSorted() {
            const remainingItems = document.querySelectorAll('.trash-item[draggable="true"]');
            if (remainingItems.length === 0) {
                completeMiniGame(2);
            }
        }
    </script>
</body>
</html>